<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // 实现new关键字
        // 1 创建一个全新的对象，这个对象的__proto__指向构造函数的原型对象
        // 2 执行构造函数
        // 3 返回值未Object类型则作为new方法的返回值返回，否则返回上述全新对象
        function New() {
            console.log(arguments);
            // 1 取出构造函数
            let Constructor = [].shift.call(arguments);

            // 2 返回的结果
            let obj = {};

            // 3 连接到原型
            obj.__proto__ = Constructor.prototype;

            // 4 调用一个具有给定this值的函数。执行构造函数
            let result = Constructor.call(obj, arguments);

            // 5 优先返回构造函数返回的对象
            return result instanceof Object ? result : obj;
        }
        
        function Animal(type) {
            this.type = type;
            // return { name: 'dog' };
        }
        Animal.prototype.say = function() {
            console.log('say');
        }
        // let animal = new Animal('哺乳类');
        let animal = New(Animal, '哺乳类');
        console.log(animal.type);
        animal.say();



        // instanceof实现原理：new Constructor().__proto__ === constructor.prototype
        // left是左边的式子，right是右边的式子。将instanceof实现转化为数学证明
        function myInstanceOf(left, right) {
            left = left.__proto__;
            while(true) {
                // Object.prototype.__proto__ === null
                if (left === null) {
                    return false;
                }
                if (left === right.prototype) {
                    return true;
                }
                left = left.__proto__;
            }
        }
        function Person(){}
        function Persons(){}

        const p = new Person();
        console.log(myInstanceOf(p, Person));
        console.log(myInstanceOf(p, Persons));


        // 实现create
        // Object.create()方法创建一个新对象，使用现有的对象来提供新创建的对象的__proto__
        Object.prototype.myCreate = function(obj) {
            function Fn() {};
            Fn.prototype = obj;
            Fn.prototype.constructor = Fn;
            return new Fn();
        }   
        let demo = {
            c : '123'
        };

        let cc = Object.myCreate(demo);
        console.log(cc.c);
    </script>
</body>
</html>